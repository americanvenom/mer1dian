<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="nui://game/ui/jquery.js" type="text/javascript"></script>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="data/css/style.css">
    <title>Bank Vorp</title>
</head>

<body>


    <div class="cont-content" id="generalPage">
        <p id="bankName">BANCA DI SAINT DENIS</p>
        <p id="bankDesc">Teniamo i tuoi soldi al sicuro dal 1791</p>
        <div class="balance">
            BILANCIO<br>
            <span class="money"><span id="dollars">100.10$</span> </span>
            
        </div>
        <div class="btn-options">
            <button class="btn deposit">
                    <p>PRENDI 'STI SOLDI<br>
                </button>
            <button class="btn withdraw">			
                    <p>RIDAMMI I MIEI SOLDI<br>		
                </button>
            <!--<button class="btn transfer">			
                    <p>TRASFERISCI<br>			
                </button>-->
            <button class="btn exit"><p>ESCI<br></button>
        </div>
    </div>

    <div class="cont-content" id="depositPage">
        <p id="bankName">BANCA DI SAINT DENIS</p>
        <p id="bankDesc">Teniamo i tuoi soldi al sicuro dal 1791</p>
        <div class="deposit-info">
            Deposita i tuoi soldi<br> $
            <input type="number" placeholder="1.0" step="0.01" min="0" max="100000" name="dmoneyinput"><br>
            <button class="btn" id="sendDeposit">Prendi 'sti soldi</button>
        </div>
        <div class="btn-options-deposit">
            <button class="btn general">
                    <p>GENERALE<br>
                </button>
            <button class="btn withdraw">			
                    <p>RIDAMMI I MIEI SOLDI<br>		
                </button>
            <!--<button class="btn transfer">			
                    <p>TRASFERISCI<br>			
                </button>-->	
            <button class="btn exit"><p>ESCI<br></button>
        </div>
    </div>

    <div class="cont-content" id="withdrawPage">
        <p id="bankName">BANCA DI SAINT DENIS</p>
        <p id="bankDesc">Teniamo i tuoi soldi al sicuro dal 1791</p>
        <div class="deposit-info">
            Preleva i tuoi soldi<br> $
            <input type="number" placeholder="1.0" step="0.01" min="0" max="100000" name="wmoneyinput"> <br>
            <button class="btn" id="sendWithdraw">Ridammi i miei soldi</button>
        </div>
        <div class="btn-options-deposit">
            <button class="btn general">
                    <p>GENERALE<br>
                </button>
            <button class="btn deposit">		  
                    <p>PRENDI 'STI SOLDI<br>
                </button>
            <button class="btn transfer">			
                    <p>RIDAMMI I MIEI SOLDI<br>		
                </button>
            <button class="btn exit"><p>ESCI<br></button>
        </div>
    </div>

    <div class="cont-content" id="transfersPage">
        <p id="bankName">BANCA DI SAINT DENIS</p>
        <p id="bankDesc">Teniamo i tuoi soldi al sicuro dal 1791</p>
        <div class="transfers-info">
            Trasferimenti<br>
            <div style="height:80px; overflow:auto;">
                <table id="transfer-log" cellspacing="0" cellpadding="1" border="1">
                    <tr>
                        <th>Data</th>
                        <th>Dollari</th>
                        
                        <th>Persona</th>
                        <th>Operazione</th>
                    </tr>
                </table>
            </div>
            <button class="btn createNewTransfer">
                <p>NUOVO TRASFERIMENTO<br>
            </button>
        </div>
        <div class="btn-options-deposit">
            <button class="btn general">
                    <p>GENERALE<br>
                </button>
            <button class="btn deposit">		  
                    <p>PRENDI 'STI SOLDI<br>
                </button>
            <button class="btn exit"><p>EXIT<br></button>
        </div>
    </div>

    <div class="cont-content" id="newTransferPage">
        <p id="bankName">BANCA DI SAINT DENIS</p>
        <p id="bankDesc">Teniamo i tuoi soldi al sicuro dal 1791</p>
        <div class="transfer-info">
            <input placeholder="Nome utente" name="suser" minlength="3" type="text"><button class="btn" id="searchUsers">Cerca</button><br>
            <select placeholder="Seleziona utente" name="user" list="users" id="users"></select><input placeholder="Motivo" name="reason" minlength="3" maxlength="40" type="text"> $
            <input type="number" placeholder="1.0" step="0.01" min="0" max="100000" name="tmoneyinput"> <br>
            <input type="checkbox" id="instantBox" value=""> Trasferimento istantaneo ($10.00 di tasse)<br>

            <button class="btn" id="sendTransfer">Manda trasferimento</button>
        </div>
        <div class="btn-options-deposit">
            <button class="btn general">
                    <p>GENERALE<br>
                </button>
            <button class="btn deposit">		  
                    <p>PRENDI 'STI SOLDI<br>
                </button>
            <!--<button class="btn transfer">			
                    <p>TRASFERISCI<br>			
                </button>-->
            <button class="btn exit"><p>ESCI<br></button>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

    <script type="text/javascript">
        $("document").ready(function() {

            //Hide all pages
            $('#withdrawPage').hide();
            $('#depositPage').hide();
            $('#transfersPage').hide();
            $('#newTransferPage').hide();
            $('#generalPage').hide();

            //Deposit
            $('.deposit').click(function() {
                $('#withdrawPage').hide();
                $('#generalPage').hide();
                $('#transfersPage').hide();
                $('#newTransferPage').hide();
                $('#depositPage').show();
            });

            //General
            $('.general').click(function() {
                $('#depositPage').hide();
                $('#withdrawPage').hide();
                $('#transfersPage').hide();
                $('#newTransferPage').hide();
                $('#generalPage').show();
            });

            $('.withdraw').click(function() {
                $('#depositPage').hide();
                $('#generalPage').hide();
                $('#transfersPage').hide();
                $('#newTransferPage').hide();
                $('#withdrawPage').show();
            });

            $('.transfer').click(function() {
                $('#depositPage').hide();
                $('#generalPage').hide();
                $('#withdrawPage').hide();
                $('#newTransferPage').hide();
                $('#transfersPage').show();
            });

            $('.createNewTransfer').click(function() {
                $('#depositPage').hide();
                $('#generalPage').hide();
                $('#withdrawPage').hide();
                $('#transfersPage').hide();
                $('#newTransferPage').show();
            });

            //Deposit Function
            $('#sendDeposit').click(function() {
                var dollars = $('input[type=number][name=dmoneyinput]').val();
                var golds = $('input[type=number][name=dgoldinput]').val();

                if (!dollars && !golds) {
                    console.log("Vacia");
                    return;
                }

                if (!dollars) {
                    dollars = 0.00;
                }
                if (!golds) {
                    golds = 0.00;
                }

                $.post("http://vorp_banks/Deposit", JSON.stringify({
                    money: dollars,
                    gold: golds
                }));
            });

            //Withdraw Function
            $('#sendWithdraw').click(function() {
                var dollars = $('input[type=number][name=wmoneyinput]').val();
                var golds = $('input[type=number][name=wgoldinput]').val();

                if (!dollars && !golds) {
                    console.log("Vacia");
                    return;
                }

                if (!dollars) {
                    dollars = 0.00;
                }
                if (!golds) {
                    golds = 0.00;
                }

                $.post("http://vorp_banks/Withdraw", JSON.stringify({
                    money: dollars,
                    gold: golds,
                    type: "withdraw"
                }));
            });

            //SendTransfer Function
            $('#sendTransfer').click(function() {
                console.log("porco dio la madonna zoccola");
                var dollars = $('input[type=number][name=tmoneyinput]').val();
                console.log("porco dio la madonna zoccola");
                var reason = $('input[type=text][name=reason]').val();
                console.log("porco dio la madonna zoccola");
                var values = JSON.parse($("#users").children("option:selected").val());
                console.log("porco dio la madonna zoccola");
                
                var isInstant = document.getElementById("instantBox").checked;
                
                console.log(dollars)
                console.log(reason)
                console.log(isInstant)
                console.log(values.steam)
                console.log(values.charid)

                if (!dollars) {
                    dollars = "0";
                }
                $.post("http://vorp_banks/Transfer", JSON.stringify({
                    steam: values.steam,
                    charid: values.charid,
                    subject: reason,
                    money: dollars,
                    gold: 0,
                    instant: isInstant
                }));

            });

            //SearchUsers Function
            $('#searchUsers').click(function() {
                var names = $('input[type=text][name=suser]').val();

                if (!names && names.length < 3) {
                    console.log("Vacia");
                    return;
                }

                $.post("http://vorp_banks/SearchUsers", JSON.stringify({
                    name: names,
                }));

            });

            //Close Function
            $('.exit').click(function() {
                $('#depositPage').hide();
                $('#generalPage').hide();
                $('#withdrawPage').hide();
                $('#transfersPage').hide();
                $('#newTransferPage').hide();
                $.post("http://vorp_banks/NUIFocusOff", JSON.stringify({}));
            });

            window.addEventListener("message", function(event) {
                let data = event.data;
                if (data !== undefined) {
                    if (data.action === "showAccount") { //action updateData
                        //Bank Name
                        document.getElementById("bankName").innerText = data.bank;
                        document.getElementById("dollars").innerText = "$ " + data.money;

                        $('#generalPage').show();
                    } else if (data.action === "showUsers") {
                        $('#users').html("");
                        data.userList.forEach(element => {
                            var values = {
                                steam: element.steam,
                                charid: element.charid
                            }
                            $("#users").append($('<option>', {
                                value: JSON.stringify(values),
                                text: element.name
                            }));
                        });
                    } else if (data.action === "showTransfers") {
                        $('#transfer-log').html("");

                        $('#transfer-log').append("<tr><th>Date</th><th>Dollars</th><th>Gold</th><th>Subject</th><th>Operation</th></tr>");

                        data.transfers.forEach(element => {
                            $('#transfer-log').append(" <tr>" +
                                "<th>" + element.date + "</th>" +
                                "<th>" + element.money + "</th>" +
                                "<th>" + element.gold + "</th>" +
                                "<th>" + element.msg + "</th>" +
                                "<th>" + element.operation + "</th>" +
                                "</tr>");
                        });
                    } else if (data.action === "updateNumbers") {
                        document.getElementById("dollars").innerText = data.money;
                    }else if(data.action === "updateTransactions"){
                        data.transfers.forEach(element => {
                            $('#transfer-log').append(" <tr>" +
                                "<th>" + element.date + "</th>" +
                                "<th>" + element.money + "</th>" +
                                "<th>" + element.gold + "</th>" +
                                "<th>" + element.msg + "</th>" +
                                "<th>" + element.operation + "</th>" +
                                "</tr>");
                        });
                    }

                }
            });

        });
    </script>
</body>

</html>